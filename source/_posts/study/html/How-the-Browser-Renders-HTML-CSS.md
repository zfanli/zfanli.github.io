---
title: æµè§ˆå™¨å¦‚ä½•æ¸²æŸ“ç½‘é¡µï¼Ÿ- DOMï¼ŒCSSOM & Render Tree
tags:
  - Browser
  - HTML
  - CSS
date: "2021-08-26T14:17:44.900Z"
categories:
  - study
  - html
---

ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼Œä½ ä¼šå‘ç°æœ‰ä¸€éƒ¨åˆ†ç½‘é¡µèµ„æºåœ¨åŠ è½½å®Œä¹‹å‰ä¼šé˜»å¡æµè§ˆå™¨çš„æ¸²æŸ“è¿›ç¨‹ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†ç½‘é¡µèµ„æºå¯ä»¥è¢«å¼‚æ­¥åŠ è½½ã€‚å‰ç«¯å¼€å‘æ—¶ä½ å¶å°”ä¼šé‡åˆ°è¿™äº›é—®é¢˜ï¼šèµ„æºä¸‹è½½é€Ÿåº¦**ç¼“æ…¢**ï¼Ÿé¦–å±ç­‰å¾…**å¤šä½™çš„æ–‡ä»¶**ä¸‹è½½å’Œåˆå§‹åŒ–ï¼Ÿæœªåº”ç”¨ CSS çš„å†…å®¹**ä¸€é—ªè€Œè¿‡**ï¼ˆflash of unstyled contentï¼Œ`FOUC`ï¼‰ï¼Ÿè¦é¿å…å®ƒä»¬ï¼Œå¼€å‘ä¸€ä¸ªç”¨æˆ·ä½“éªŒä¼˜ç§€çš„ç½‘ç«™ï¼Œä½ éœ€è¦çš„æ˜¯ç†è§£æµè§ˆå™¨æ¸²æŸ“ç½‘é¡µçš„é€»è¾‘ä¸é¡ºåºã€‚

å½“æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ä»¥è·å– HTMLï¼ŒæœåŠ¡å™¨ç”¨**äºŒè¿›åˆ¶æµï¼ˆ`binary stream`ï¼‰**å½¢å¼è¿”å› HTML çš„æ–‡æœ¬å†…å®¹ï¼Œåœ¨å“åº”ä¸­ï¼ŒæœåŠ¡å™¨å°† header éƒ¨åˆ†çš„ `Content-Type` å±æ€§çš„å€¼è®¾ç½®ä¸º `text/html; charset=UTF-8`ã€‚å…¶ä¸­ `text/html` éƒ¨åˆ†å‘Šè¯‰æµè§ˆå™¨å“åº”æ•°æ®æ˜¯ä¸€ä»½ HTML æ–‡æœ¬ï¼›`charset=UTF-8` éƒ¨åˆ†å‘Šè¯‰æµè§ˆå™¨å“åº”æ•°æ®ä½¿ç”¨çš„å­—ç¬¦é›†ã€‚æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæµè§ˆå™¨å°±å¯ä»¥æ­£å¸¸çš„è§£æ HTML æ ‡ç­¾å¹¶å¯¹ç½‘é¡µè¿›è¡Œæ¸²æŸ“äº†ã€‚ç›¸åï¼Œå¦‚æœå“åº”çš„ header éƒ¨åˆ†ä¸­ç¼ºå°‘äº† `Content-Type` å±æ€§ï¼Œæµè§ˆå™¨ä¼šå› ä¸ºç¼ºå°‘å¯¹å“åº”æ•°æ®çš„æè¿°ä¿¡æ¯è€Œå°†å…¶æ•°æ®ä»¥çº¯æ–‡æœ¬çš„æ–¹å¼å±•ç°ç»™ç”¨æˆ·ã€‚

æµè§ˆå™¨è¦æ¸²æŸ“çš„ç½‘é¡µä¸»ä½“ç”± HTML æ–‡æœ¬æ„æˆï¼Œé€šå¸¸æœ‰é¢å¤–çš„ CSS æ–‡ä»¶æä¾›æ ·å¼ï¼Œæœ‰ JS æ–‡ä»¶æä¾›è„šæœ¬æ“ä½œã€‚ä¸è¿‡æµè§ˆå™¨åˆ°åº•æ˜¯å¦‚ä½•ä»ä¸€å †æ–‡æœ¬ä¿¡æ¯ä¸­çŸ¥é“å¦‚ä½•æ¸²æŸ“ä¸€ä¸ªç½‘é¡µï¼Ÿè®¨è®ºè¿™ä»¶äº‹æƒ…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä»€ä¹ˆæ˜¯ **DOM**ã€**CSSOM** å’Œ **Render Tree**ã€‚

<!-- more -->

## Document Object Model (DOM)

æµè§ˆå™¨ä¼šå°†æ‰€æœ‰ HTML å…ƒç´ è½¬æ¢ä¸º JavaScript çš„ **Node** å¯¹è±¡ã€‚å› ä¸º HTML å…ƒç´ å­˜åœ¨ä¸åŒçš„æ ‡ç­¾å’Œä¸åŒçš„å±æ€§ï¼Œæµè§ˆå™¨åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ä¼šå°†å®ƒä»¬å˜æˆä¸åŒçš„ Node å­ç±»ã€‚

> ğŸ’¡ æ¯”å¦‚ `div` å…ƒç´ ä¼šè¢«è½¬æ¢ä¸º**ç»§æ‰¿** `Node` çš„å­ç±» `HTMLDivElement`ã€‚éšä¾¿æ‰¾ä¸€ä¸ªç½‘é¡µï¼Œæ‰“å¼€å¼€å‘è€…æ§åˆ¶å°ï¼Œè¾“å…¥ä¸‹é¢ä»£ç æ¥æ¥çœ‹çœ‹ç»“æœã€‚
>
> ```js
> const div = document.querySelector("div");
> // ...
> div instanceof HTMLDivElement;
> // true
> div instanceof Node;
> // true
> ```
>
> é™¤æ­¤ä¹‹å¤–ï¼Œæµè§ˆå™¨ç»™æ¯ä¸€ä¸ª HTML å…ƒç´ åˆ›å»ºäº†å¯¹åº”çš„ç±»ï¼Œæ¯”å¦‚ `HTMLScriptElement` ç­‰ã€‚

ç”±äº HTML ä¸­çš„å…ƒç´ æ˜¯ç›¸äº’åµŒå¥—çš„ï¼Œæµè§ˆå™¨åˆ›å»ºæ¯ä¸ªå…ƒç´ çš„ Node å¯¹è±¡ä¹‹åä¼šå°†å®ƒä»¬æŒ‰ç…§ HTML ä¸­çš„å…³ç³»æ¥åˆ›å»ºä¸€ä¸ªæ ‘å½¢æ•°æ®ï¼Œä»¥æ­¤æ¥åœ¨ç½‘é¡µçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…æœ‰æ•ˆçš„æ¸²æŸ“å’Œç®¡ç†å…ƒç´ ã€‚è€Œè¿™ä¸ªæ ‘å½¢æ•°æ®ä¹Ÿå°±æ˜¯æ‰€è°“çš„ **DOM æ ‘**ã€‚

```console
                                  +-----------------+
                                  |      html       |
                                  | HTMLHtmlElement |
                                  +-----/-----\-----+
                                  /------       -------\
                          /------                      -------\
              +-----------------+                         +-----------------+
              |      head       |                         |     body        |
              | HTMLHeadElement |                         | HTMLBodyElement |
              +-------/-\-------+                         +-------/-\-------+
                   /--   --\                                   /--   --\
                 /-         -\                               /-         -\
              /--             --\                         /--             --\
  +------------------+   +-----------------+  +------------------+  +-------------------+
  |       title      |   |      link       |  |       div        |  |       script      |
  | HTMLTitleElement |   | HTMLLinkElement |  |  HTMLDivElement  |  | HTMLScriptElement |
  +------------------+   +-----------------+  +--------/-\-------+  +-------------------+
                                                    /--   ---\
                                                /---          --\
                                            /--                 ---\
                                +--------------------+    +----------------------+
                                |         h1         |    |           p          |
                                | HTMLHeadingElement |    | HTMLParagraphElement |
                                +----------|---------+    +-----------|----------+
                                           |                          |
                                           |                          |
                                +----------|---------+    +-----------|----------+
                                |     (TextNode)     |    |       (TextNode)     |
                                |     Text here      |    |       Text here      |
                                +--------------------+    +----------------------+
```

DOM æ ‘çš„ç»“æ„ç±»ä¼¼ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œå…¶ä»æœ€ä¸Šé¢çš„æ ¹èŠ‚ç‚¹ `html` å…ƒç´ å¼€å§‹ï¼ŒæŒ‰ç…§æ¯ä¸ªå…ƒç´ å‡ºç°çš„é¡ºåºå’ŒåµŒå¥—çš„å…³ç³»å‘ä¸‹åˆ†æ”¯ã€‚æ¯å½“æµè§ˆå™¨é‡åˆ°ä¸€ä¸ª HTML å…ƒç´ æ—¶ï¼Œå°±ä¼šåœ¨ DOM æ ‘ä¸Šç”¨è¿™ä¸ªå…ƒç´ çš„ç±»åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ã€‚ä¸è¿‡ DOM æ ‘çš„èŠ‚ç‚¹ä¸ä»…åŒ…æ‹¬ HTML å…ƒç´ ï¼Œå…¶ä»–è¯¸å¦‚æ³¨é‡Šã€å±æ€§ã€æ–‡æœ¬ç­‰ç±»å‹çš„æ•°æ®ä¹Ÿä¼šè¢«åˆ›å»ºæˆä¸€ä¸ªèŠ‚ç‚¹å­˜åœ¨äº DOM æ ‘çš„æ•°æ®ç»“æ„ä¹‹ä¸­ã€‚ä½†æ˜¯ç®€å•èµ·è§ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»¬åªå…³æ³¨ DOM æ ‘ä¸­çš„ HTML å…ƒç´ èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ DOM å…ƒç´ ã€‚ï¼ˆä½ å¯ä»¥ä»[è¿™ä¸ªåˆ—è¡¨](https://www.w3schools.com/jsref/prop_node_nodetype.asp)äº†è§£ä¸€å…± 12 ç§ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ã€‚ï¼‰

ä½ å¯ä»¥åœ¨æµè§ˆå™¨å¼€å‘è€…æ§åˆ¶å°çš„ Elements æ ‡ç­¾é¡µçœ‹åˆ° DOM æ ‘çš„å¯è§†åŒ–è¡¨ç°ã€‚ä»å¯è§†åŒ–çš„è§†å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ° DOM å…ƒç´ çš„å±‚çº§å…³ç³»å’Œæ¯ä¸ªå…ƒç´ çš„å±æ€§ã€‚DOM å¹¶é JavaScript çš„è§„æ ¼å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ç”±æµè§ˆå™¨æä¾›çš„é«˜çº§ Web APIï¼Œç›®çš„æ˜¯ä¸ºäº†é«˜æ•ˆåœ°æ¸²æŸ“ç½‘é¡µï¼ŒåŒæ—¶å…¬å¼€ç»™å¼€å‘è€…æ ¹æ®éœ€æ±‚åŠ¨æ€åœ°æ“ä½œ DOM å…ƒç´ ã€‚

> ğŸ’¡ é€šè¿‡ DOM APIï¼Œå¼€å‘è€…å¯ä»¥å¯¹ HTML å…ƒç´ è¿›è¡Œæ·»åŠ å’Œåˆ é™¤æ“ä½œï¼Œå¯ä»¥æ”¹å˜ HTML å…ƒç´ çš„å¤–è§‚ï¼Œæˆ–è€…ç›‘å¬ç›¸åº”çš„äº‹ä»¶ã€‚ä½¿ç”¨ DOM API æ—¶ï¼ŒHTML å…ƒç´ å¯ä»¥ä¸å½±å“å·²æ¸²æŸ“çš„ DOM æ ‘ï¼Œåœ¨å†…å­˜ä¸­è¿›è¡Œåˆ›å»ºå’Œå¤åˆ¶æ“ä½œã€‚è¿™ä¸ªç‰¹æ€§è®©å‰ç«¯å¼€å‘å¯ä»¥è®¾è®¡å‡ºç”¨æˆ·ä½“éªŒæ›´å¥½çš„åŠ¨æ€é¡µé¢ã€‚

## CSS Object Model (CSSOM)

æˆ‘ä»¬å¯ä»¥é€šè¿‡ CSS ç»™æŒ‡å®šçš„ HTML å…ƒç´ æä¾›æ ·å¼ã€‚è¿™äº› CSS çš„å®šä¹‰å¯ä»¥ç”¨å¤–éƒ¨æ–‡ä»¶å¯¼å…¥åˆ°å½“å‰é¡µé¢ä¸­ï¼›å¯ä»¥ä½¿ç”¨ style æ ‡ç­¾å°† CSS å®šä¹‰åµŒå…¥åˆ°å½“å‰é¡µé¢ä¸­ï¼›æˆ–è€…åœ¨ HTML æ ‡ç­¾ä¸Šä½¿ç”¨ inline å±æ€§æ¥é’ˆå¯¹å•ä¸ªå…ƒç´ çš„ CSS å±æ€§ã€‚æ­¤å¤–ï¼Œé€šè¿‡ JavaScript ä¹Ÿå¯ä»¥åŠ¨æ€çš„è®¾å®šå…ƒç´ çš„ CSS å±æ€§ã€‚

æœ€ç»ˆï¼Œæµè§ˆå™¨ä¼šè´Ÿè´£è¿™é‡Œæœ€å›°éš¾çš„å·¥ä½œï¼Œå°†è¿™äº›æ‰€æœ‰çš„ CSS å±æ€§çš„å®šä¹‰æ•´åˆåˆ°ä¸€å—ï¼Œå¹¶åº”ç”¨åˆ°å¯¹åº”çš„ DOM å…ƒç´ ä¸Šã€‚

åœ¨æ„ç­‘å®Œ DOM æ ‘ä¹‹åï¼Œæµè§ˆå™¨ä¼šè¯»å–å„ç§æ¥æºçš„ CSS å±æ€§å®šä¹‰ï¼Œè¯¸å¦‚å¤–éƒ¨çš„ã€å†…åµŒçš„ã€è¡Œå†…çš„è¿˜æœ‰ç”¨æˆ·ä»£ç†ï¼ˆUser Agentï¼Œå³æµè§ˆå™¨ï¼‰å®šä¹‰çš„æ‰€æœ‰ CSS å±æ€§ï¼Œå°†å…¶æ„å»ºæˆ CSSOM æ ‘ï¼Œå°±åƒ DOM æ ‘ä¸€æ ·ã€‚

CSSOM æ ‘çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹åŒ…å«éœ€è¦åº”ç”¨åˆ°é€‰æ‹©å™¨ç›®æ ‡çš„ DOM å…ƒç´ ä¸Šçš„ CSS æ ·å¼ï¼Œä½†æ˜¯ä¸åŒ…å«ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„å…ƒç´ ï¼Œæ¯”å¦‚ metaã€style ç­‰ã€‚

ä¹‹å‰æœ‰æåˆ°ç”¨æˆ·ä»£ç†æ ·å¼ï¼Œå¤§éƒ¨åˆ†æµè§ˆå™¨ä¼šæä¾›ä¸€å¥—è‡ªå·±çš„é»˜è®¤æ ·å¼ï¼Œå³ User Agent Stylesheetã€‚æµè§ˆå™¨é€šè¿‡å°†å¼€å‘è€…æŒ‡å®šçš„ CSS å±æ€§è¦†ç›–é»˜è®¤å¼æ ·æ¥è®¡ç®—æœ€ç»ˆçš„å±æ€§å€¼ï¼Œç„¶ååˆ›å»º CSSOM çš„èŠ‚ç‚¹ã€‚

ä½†æ˜¯å¦‚æœæµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†æ ·å¼å’Œå¼€å‘è€…æŒ‡å®šçš„ CSS å±æ€§éƒ½æ²¡æœ‰å¯¹æŸä¸ªå±æ€§è®¾å®šï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¼šæ ¹æ® W3C çš„ CSS æ ‡å‡†å°†å…¶è®¾å®šä¸ºæŒ‡å®šçš„é»˜è®¤å€¼ã€‚

å½“ä½¿ç”¨ CSS æ ‡å‡†æŒ‡å®šçš„é»˜è®¤å€¼æ—¶ï¼Œå¦‚æœåœ¨ W3C æ–‡æ¡£ä¸­æœ‰æåˆ°æŸå±æ€§çš„å€¼æ˜¯å¯ç»§æ‰¿çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šæ ¹æ®ä¸€å®šçš„ç»§æ‰¿è§„åˆ™æ¥è®¾å®šè‡ªå·±çš„å€¼ã€‚ä¾‹å¦‚ color å’Œ font-size å±æ€§åœ¨æœªæŒ‡å®šå…·ä½“å€¼çš„æ—¶å€™ï¼Œä¼šä»å…¶çˆ¶å…ƒç´ ç»§æ‰¿ã€‚æ‰€ä»¥å½“ä½ ç»™æŸä¸ª HTML å…ƒç´ è®¾å®šäº†è¿™ä¸¤ä¸ªå±æ€§ï¼Œå®ƒçš„å­å…ƒç´ ä¼šå…¨éƒ¨ç»§æ‰¿è¿™ä¸ªå€¼ã€‚è¿™ä¸ªè§„åˆ™å°±æ˜¯å±‚é‡å ï¼ˆcascadingï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ CSS è¢«ç§°ä½œå±‚é‡å æ ·å¼è¡¨ï¼ˆcascading style sheetsï¼‰ï¼ŒåŒæ ·è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæµè§ˆå™¨è¦å°† CSSOM æ„å»ºæˆä¸€ä¸ªæ ‘å½¢ç»“æ„çš„åŸå› ï¼Œæµè§ˆå™¨å¯ä»¥æ ¹æ®å…¶çˆ¶èŠ‚ç‚¹çš„æ ·å¼å’Œç»§æ‰¿è§„åˆ™æ¥è®¡ç®—æ¯ä¸ªå…ƒç´ çš„æœ€ç»ˆçš„ CSS æ ·å¼å±æ€§ã€‚

> æµè§ˆå™¨çš„å¼€å‘è€…æ§åˆ¶å°ä¸­ï¼Œåœ¨ Elements æ ‡ç­¾ä¸­æœ‰ä¸€ä¸ª Computed é¢æ¿ä¸­ä¼šæ˜¾ç¤ºå…ƒç´ æ‰€æœ‰æœ€ç»ˆè®¡ç®—å‡ºæ¥çš„å±æ€§å€¼ã€‚## Render Tree

## Render Tree

Render Tree åŒæ ·æ˜¯ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œé€šè¿‡å°† DOM æ ‘å’Œ CSSOM æ ‘ç»„åˆæ¥åˆ›å»ºã€‚æµè§ˆå™¨é€šè¿‡ Render Tree è®¡ç®—æ¯ä¸ªå¯è§å…ƒç´ çš„å›¾å±‚å¹¶å°†å…¶ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚å› æ­¤ç½‘é¡µå†…å®¹åªä¼šåœ¨æµè§ˆå™¨å°† Render Tree åˆ›å»ºå®Œæˆåæ‰ä¼šæ˜¾ç¤ºï¼Œè€Œè¦åˆ›å»º Render Treeï¼Œè¿˜éœ€è¦å…ˆåˆ›å»º DOM æ ‘å’Œ CSSOM æ ‘ã€‚

Render Tree æ˜¯ç½‘é¡µå†…å®¹è¾“å‡ºåˆ°å±å¹•ä¸Šçš„è¿‡ç¨‹ä¸­çš„åº•å±‚è¡¨è¾¾ï¼Œå…¶ä¸åŒ…å«ä¸æ˜¾ç¤ºçš„å†…å®¹ã€‚æ¯”å¦‚ dispalyï¼šnoneï¼›çš„å…ƒç´ ï¼Œä»–ä»¬åœ¨å¹³é¢ä¸Šå æ® 0px x 0px é¢ç§¯ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°åœ¨ Render Tree ä¸­ã€‚ç„¶è€Œæ ¹æ®è¿™ä¸ªè§„åˆ™ï¼Œopacity å’Œ visibility è™½ç„¶ä¹Ÿä¼šè®©å…ƒç´ ä¸å¯è§ï¼Œä½†æ˜¯å…ƒç´ å æ®çš„ç©ºé—´æ²¡æœ‰æ¶ˆå¤±ï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šå‡ºç°åœ¨ Render Tree ä¸­ã€‚

## Rendering Sequence

### Layout operation

### Paint operation

### Compositing operation

## Browser engines

- IE
  - Engine: Trident
  - CSS-prefix: `-ms`
- Edge
  - Engine: ~~EdgeHTML~~ â†’ Blink
  - CSS-prefix: `-ms`
- Firefox
  - Engine: Gecko
  - CSS-prefix: `-moz`
- Opera
  - Engine: ~~Presto~~ â†’ Blink
  - CSS-prefix: `-o` (Presto) and `-webkit` (Blink)
- Safari
  - Engine: WebKit
  - CSS-prefix: `-webkit`
- Chrome
  - Engine: ~~WebKit~~ â†’ Blink
  - CSS-prefix: `-webkit`

## Rendering Process in browsers

### Parsing and External Resources

### Parser-Blocking Scripts

## Reference

- [How the browser renders HTM & CSS](https://medium.com/@mustafa.abdelmogoud/how-the-browser-renders-html-css-27920d8ccaa6)
- [How the browser renders a web page? â€” DOM, CSSOM, and Rendering](https://medium.com/jspoint/how-the-browser-renders-a-web-page-dom-cssom-and-rendering-df10531c9969)
- [An Introduction and Guide to the CSS Object Model (CSSOM)](https://css-tricks.com/an-introduction-and-guide-to-the-css-object-model-cssom/)
- [HTML DOM nodeType Property](https://www.w3schools.com/jsref/prop_node_nodetype.asp)
